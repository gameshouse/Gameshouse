<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic Tac Toe</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Arial', sans-serif; }
        body { display: flex; justify-content: center; align-items: center; min-height: 100vh; background: #0a1d37; color: #ffd700; overflow-y: auto; transition: background 0.5s, color 0.5s; }
        body.light { background: #e6f0fa; color: #0a1d37; }
        .container { text-align: center; background: rgba(10, 29, 55, 0.9); padding: 20px; border-radius: 20px; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6); transition: background 0.5s; width: 90%; max-width: 600px; }
        body.light .container { background: rgba(255, 255, 255, 0.9); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2); }
        h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 0 3px 6px rgba(0, 0, 0, 0.5); }
        #scoreboard { font-size: 1.2em; margin-bottom: 10px; }
        #timer { font-size: 1.2em; margin-bottom: 10px; color: #ff4500; display: none; }
        #tip { font-size: 0.9em; margin-bottom: 15px; color: #00ff00; }
        .controls-top, .controls-bottom { display: flex; justify-content: center; flex-wrap: wrap; gap: 8px; margin: 15px 0; }
        button, select { padding: 6px 12px; font-size: 0.9em; border: none; border-radius: 25px; background: linear-gradient(135deg, #ffd700, #b8860b); color: #0a1d37; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3); }
        button:hover, select:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4); }
        .game-board { display: grid; gap: 12px; justify-content: center; width: 100%; }
        .cell { width: 100px; height: 100px; background: #1e3a5f; border-radius: 15px; display: flex; justify-content: center; align-items: center; font-size: 2.5em; cursor: pointer; transition: transform 0.3s, box-shadow 0.3s; box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4), inset 0 2px 5px rgba(255, 255, 255, 0.2); transform: perspective(600px) rotateX(0deg) rotateY(0deg); }
        body.light .cell { background: #f0f8ff; }
        .cell:hover { transform: perspective(600px) rotateX(8deg) rotateY(8deg); box-shadow: 0 12px 25px rgba(0, 0, 0, 0.5); }
        .cell.active { animation: bounce 0.3s ease-in-out; }
        @keyframes bounce { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
        .cell.winning { background: #ffd700; animation: glow 1s infinite alternate; }
        @keyframes glow { from { box-shadow: 0 0 15px #ffd700; } to { box-shadow: 0 0 25px #b8860b; } }
        .ad-space { position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%); width: 728px; max-width: 90%; height: 90px; z-index: 100; }
        .ad-space-small { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); width: 300px; height: 250px; z-index: 1001; }
        .popup { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); justify-content: center; align-items: center; z-index: 1000; }
        .popup-content { background: #0a1d37; padding: 20px; border-radius: 20px; text-align: center; animation: pop 0.5s ease-in-out; color: #ffd700; position: relative; width: 90%; max-width: 400px; }
        body.light .popup-content { background: #e6f0fa; color: #0a1d37; }
        @keyframes pop { 0% { transform: scale(0); } 80% { transform: scale(1.1); } 100% { transform: scale(1); } }
        #winner-text { font-size: 1.8em; margin-bottom: 15px; }
        .confetti { position: absolute; width: 10px; height: 10px; background: #ffd700; animation: fall 3s linear infinite; z-index: 999; }
        @keyframes fall { 0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
        @media (max-width: 600px) {
            .container { padding: 15px; }
            h1 { font-size: 1.8em; }
            #scoreboard, #timer, #tip { font-size: 0.9em; }
            .game-board { gap: 8px; }
            .cell { width: 80px; height: 80px; font-size: 2em; }
            button, select { padding: 5px 10px; font-size: 0.8em; }
            .ad-space { width: 320px; height: 50px; }
            .ad-space-small { width: 250px; height: 200px; right: 5px; }
            .popup-content { padding: 15px; }
            #winner-text { font-size: 1.5em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Tic Tac Toe</h1>
        <div id="scoreboard">ðŸ˜º: 0 | ðŸ¤–: 0</div>
        <div id="timer">Time Left: 8s</div>
        <div id="tip"></div>
        <div class="controls-top">
            <select id="board-size"><option value="3">3x3</option><option value="4">4x4</option><option value="5">5x5</option></select>
            <button id="mode-toggle">Player vs Player</button>
            <select id="difficulty" style="display: none;"><option value="easy">Easy</option><option value="medium">Medium</option><option value="hard">Hard</option></select>
            <button id="theme-toggle">Light Mode</button>
            <button id="mute-toggle">Mute</button>
        </div>
        <div class="game-board" id="board"></div>
        <div class="controls-bottom">
            <button id="reset">Try Again</button>
            <button id="share">Share</button>
        </div>
    </div>
    <div class="ad-space" id="ad-space">
        <ins class="adsbygoogle" style="display:inline-block;width:728px;height:90px" data-ad-client="ca-pub-XXXXXXXXXXXXXXXX" data-ad-slot="XXXXXXXXXX"></ins>
    </div>
    <div class="popup" id="popup">
        <div class="popup-content">
            <h2 id="winner-text"></h2>
            <button id="close-popup">Play Again</button>
            <div class="ad-space-small" id="ad-space-small">
                <ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-XXXXXXXXXXXXXXXX" data-ad-slot="XXXXXXXXXX"></ins>
            </div>
        </div>
    </div>

    <audio id="click-sound" src="https://www.soundjay.com/buttons/beep-01a.mp3"></audio>
    <audio id="win-sound" src="https://www.soundjay.com/human/applause-01.mp3"></audio>
    <audio id="alert-sound" src="https://www.soundjay.com/buttons/beep-02.mp3"></audio>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX" crossorigin="anonymous"></script>

    <script>
        const board = document.getElementById('board'), boardSizeSelect = document.getElementById('board-size'), modeToggle = document.getElementById('mode-toggle'),
              difficultySelect = document.getElementById('difficulty'), resetButton = document.getElementById('reset'), shareButton = document.getElementById('share'),
              themeToggle = document.getElementById('theme-toggle'), muteToggle = document.getElementById('mute-toggle'), popup = document.getElementById('popup'),
              winnerText = document.getElementById('winner-text'), closePopup = document.getElementById('close-popup'), clickSound = document.getElementById('click-sound'),
              winSound = document.getElementById('win-sound'), alertSound = document.getElementById('alert-sound'), scoreboard = document.getElementById('scoreboard'),
              timerDisplay = document.getElementById('timer'), tipDisplay = document.getElementById('tip');

        let size = 3, mode = 'pvp', difficulty = 'easy', currentPlayer = 'ðŸ˜º', gameBoard = [], gameActive = true, isMuted = false, playerScore = 0,
            computerScore = 0, timeLeft = 8, timer, gameStarted = false, lastWinner = 'ðŸ˜º';

        const tips = ["Be smart like a cat to beat the robot!", "Watch the timer or you'll lose!", "Start from the corners for better chances!",
                      "Don't laugh at the robot's moves, it's clever!", "Jump like a cat and win!"];

        function initBoard() {
            board.innerHTML = '';
            board.style.gridTemplateColumns = `repeat(${size}, 100px)`;
            gameBoard = Array(size * size).fill('');
            for (let i = 0; i < size * size; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.dataset.index = i;
                cell.addEventListener('click', () => handleCellClick(cell));
                board.appendChild(cell);
            }
            tipDisplay.textContent = tips[Math.floor(Math.random() * tips.length)];
            timerDisplay.style.display = 'none';
            gameStarted = false;
        }

        function startTimer() {
            if (!gameStarted) { timerDisplay.style.display = 'block'; gameStarted = true; }
            clearInterval(timer);
            timeLeft = 8;
            timerDisplay.textContent = `Time Left: ${timeLeft}s`;
            timer = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = `Time Left: ${timeLeft}s`;
                if (timeLeft === 3 && !isMuted) alertSound.play();
                if (timeLeft <= 0) {
                    currentPlayer = currentPlayer === 'ðŸ˜º' ? 'ðŸ¤–' : 'ðŸ˜º';
                    if (mode === 'pvc' && currentPlayer === 'ðŸ¤–') computerMove();
                    else startTimer();
                }
            }, 1000);
        }

        function handleCellClick(cell) {
            const index = cell.dataset.index;
            if (gameBoard[index] !== '' || !gameActive) return;
            gameBoard[index] = currentPlayer;
            cell.textContent = currentPlayer;
            cell.classList.add('active');
            if (!isMuted) clickSound.play();
            if (!gameStarted) startTimer();
            checkGameStatus();
        }

        function checkGameStatus() {
            if (checkWin()) {
                highlightWinningLine();
                updateScore();
                lastWinner = currentPlayer;
                showWinnerPopup(currentPlayer === 'ðŸ˜º' ? `ðŸ˜º Wins! Congratulations!` : `ðŸ¤– Wins! Congratulations!`);
                if (!isMuted) winSound.play();
                gameActive = false;
                triggerConfetti();
                clearInterval(timer);
                timerDisplay.style.display = 'none';
            } else if (gameBoard.every(cell => cell !== '')) {
                showWinnerPopup("It's a Tie!");
                lastWinner = 'ðŸ˜º';
                clearInterval(timer);
                timerDisplay.style.display = 'none';
            } else {
                currentPlayer = currentPlayer === 'ðŸ˜º' ? 'ðŸ¤–' : 'ðŸ˜º';
                startTimer();
                if (mode === 'pvc' && currentPlayer === 'ðŸ¤–' && gameActive) setTimeout(computerMove, 300);
            }
        }

        function checkWin() {
            const winLength = size >= 4 ? 4 : size;
            for (let i = 0; i < size; i++) for (let j = 0; j <= size - winLength; j++) if (checkLine(i * size + j, 1) || checkLine(j * size + i, size)) return true;
            for (let i = 0; i <= size - winLength; i++) for (let j = 0; j <= size - winLength; j++) if (checkLine(i * size + j, size + 1) || checkLine((i + 1) * size - j - 1, size - 1)) return true;
            return false;
        }

        function checkLine(start, step) {
            const winLength = size >= 4 ? 4 : size;
            for (let i = 0; i < winLength; i++) if (gameBoard[start + i * step] !== currentPlayer) return false;
            return true;
        }

        function highlightWinningLine() {
            const cells = document.querySelectorAll('.cell'), winLength = size >= 4 ? 4 : size, winningIndices = [];
            for (let i = 0; i < size; i++) {
                for (let j = 0; j <= size - winLength; j++) {
                    if (checkLine(i * size + j, 1)) for (let k = 0; k < winLength; k++) winningIndices.push(i * size + j + k);
                    if (checkLine(j * size + i, size)) for (let k = 0; k < winLength; k++) winningIndices.push(j * size + i + k * size);
                }
            }
            for (let i = 0; i <= size - winLength; i++) {
                for (let j = 0; j <= size - winLength; j++) {
                    if (checkLine(i * size + j, size + 1)) for (let k = 0; k < winLength; k++) winningIndices.push(i * size + j + k * (size + 1));
                    if (checkLine((i + 1) * size - j - 1, size - 1)) for (let k = 0; k < winLength; k++) winningIndices.push((i + 1) * size - j - 1 + k * (size - 1));
                }
            }
            winningIndices.forEach(index => cells[index].classList.add('winning'));
        }

        function computerMove() {
            let available = gameBoard.map((val, idx) => val === '' ? idx : null).filter(val => val !== null);
            if (available.length === 0) return;
            let move = difficulty === 'easy' ? (Math.random() < 0.7 ? available[Math.floor(Math.random() * available.length)] : findWinningMove('ðŸ¤–') || findBlockingMove('ðŸ˜º') || available[Math.floor(Math.random() * available.length)]) :
                       difficulty === 'medium' ? (Math.random() < 0.3 ? available[Math.floor(Math.random() * available.length)] : findWinningMove('ðŸ¤–') || findBlockingMove('ðŸ˜º') || findStrategicMove() || available[Math.floor(Math.random() * available.length)]) :
                       minimax(gameBoard, 'ðŸ¤–', 4).index;
            gameBoard[move] = currentPlayer;
            const cell = document.querySelector(`.cell[data-index="${move}"]`);
            cell.textContent = currentPlayer;
            cell.classList.add('active');
            if (!isMuted) clickSound.play();
            if (!gameStarted) startTimer();
            checkGameStatus();
        }

        function findWinningMove(player) {
            for (let i = 0; i < size * size; i++) if (gameBoard[i] === '') { gameBoard[i] = player; if (checkWin()) { gameBoard[i] = ''; return i; } gameBoard[i] = ''; }
            return null;
        }

        function findBlockingMove(player) { return findWinningMove(player); }

        function findStrategicMove() {
            const center = Math.floor((size * size) / 2);
            if (gameBoard[center] === '') return center;
            const corners = [0, size - 1, size * (size - 1), size * size - 1];
            for (let corner of corners) if (gameBoard[corner] === '') return corner;
            return null;
        }

        function minimax(board, player, depth) {
            let available = board.map((val, idx) => val === '' ? idx : null).filter(val => val !== null);
            if (depth <= 0 || available.length === 0 || checkWinner('ðŸ˜º') || checkWinner('ðŸ¤–')) return { score: checkWinner('ðŸ˜º') ? -10 : checkWinner('ðŸ¤–') ? 10 : 0 };
            let bestMove = player === 'ðŸ¤–' ? { score: -Infinity } : { score: Infinity };
            for (let i = 0; i < available.length; i++) {
                board[available[i]] = player;
                let result = minimax(board, player === 'ðŸ¤–' ? 'ðŸ˜º' : 'ðŸ¤–', depth - 1);
                board[available[i]] = '';
                if (player === 'ðŸ¤–' && result.score > bestMove.score) { bestMove.score = result.score; bestMove.index = available[i]; }
                else if (player === 'ðŸ˜º' && result.score < bestMove.score) { bestMove.score = result.score; bestMove.index = available[i]; }
            }
            return bestMove;
        }

        function checkWinner(player) {
            const winLength = size >= 4 ? 4 : size;
            for (let i = 0; i < size; i++) for (let j = 0; j <= size - winLength; j++) if (checkLineForPlayer(i * size + j, 1, player) || checkLineForPlayer(j * size + i, size, player)) return true;
            for (let i = 0; i <= size - winLength; i++) for (let j = 0; j <= size - winLength; j++) if (checkLineForPlayer(i * size + j, size + 1, player) || checkLineForPlayer((i + 1) * size - j - 1, size - 1, player)) return true;
            return false;
        }

        function checkLineForPlayer(start, step, player) {
            const winLength = size >= 4 ? 4 : size;
            for (let i = 0; i < winLength; i++) if (gameBoard[start + i * step] !== player) return false;
            return true;
        }

        function updateScore() {
            if (currentPlayer === 'ðŸ˜º') playerScore++; else if (currentPlayer === 'ðŸ¤–') computerScore++;
            scoreboard.textContent = `ðŸ˜º: ${playerScore} | ðŸ¤–: ${computerScore}`;
        }

        function showWinnerPopup(message) {
            winnerText.textContent = message;
            popup.style.display = 'flex';
            document.body.style.background = 'url("https://media.giphy.com/media/3o6Zt6KHxJTbXCnSso/giphy.gif") center/cover';
            (adsbygoogle = window.adsbygoogle || []).push({});
        }

        function triggerConfetti() {
            for (let i = 0; i < 150; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.background = ['#ffd700', '#ff4500', '#00ff00', '#1e90ff', '#ff69b4'][Math.floor(Math.random() * 5)];
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.width = Math.random() * 10 + 5 + 'px';
                confetti.style.height = Math.random() * 10 + 5 + 'px';
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 3000);
            }
        }

        function resetGame() {
            gameActive = true;
            currentPlayer = lastWinner;
            gameBoard = Array(size * size).fill('');
            board.innerHTML = '';
            board.style.gridTemplateColumns = `repeat(${size}, 100px)`;
            for (let i = 0; i < size * size; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.dataset.index = i;
                cell.addEventListener('click', () => handleCellClick(cell));
                board.appendChild(cell);
            }
            popup.style.display = 'none';
            document.body.style.background = document.body.classList.contains('light') ? '#e6f0fa' : '#0a1d37';
            document.querySelectorAll('.cell.winning').forEach(cell => cell.classList.remove('winning'));
            document.querySelectorAll('.confetti').forEach(confetti => confetti.remove());
            clearInterval(timer);
            timerDisplay.style.display = 'none';
            tipDisplay.textContent = tips[Math.floor(Math.random() * tips.length)];
            gameStarted = false;
            (adsbygoogle = window.adsbygoogle || []).push({});
        }

        boardSizeSelect.addEventListener('change', e => { size = parseInt(e.target.value); resetGame(); });
        modeToggle.addEventListener('click', () => { mode = mode === 'pvp' ? 'pvc' : 'pvp'; modeToggle.textContent = mode === 'pvp' ? 'Player vs Player' : 'Player vs Computer'; difficultySelect.style.display = mode === 'pvc' ? 'inline-block' : 'none'; resetGame(); });
        difficultySelect.addEventListener('change', e => { difficulty = e.target.value; resetGame(); });
        resetButton.addEventListener('click', resetGame);
        closePopup.addEventListener('click', resetGame);
        shareButton.addEventListener('click', () => navigator.share({ title: 'Tic Tac Toe', url: window.location.href }));
        themeToggle.addEventListener('click', () => { document.body.classList.toggle('light'); themeToggle.textContent = document.body.classList.contains('light') ? 'Dark Mode' : 'Light Mode'; resetGame(); });
        muteToggle.addEventListener('click', () => { isMuted = !isMuted; muteToggle.textContent = isMuted ? 'Unmute' : 'Mute'; });

        initBoard();
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</body>
</html>
