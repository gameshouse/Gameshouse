<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic Tac Toe Universe - Final Edition</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <!-- Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        /* CSS Styling - Enhanced */
        :root {
            /* Default Light Theme Colors */
            --gradient-start: #6e8efb;
            --gradient-mid: #a777e3;
            --gradient-end: #3f5efb;
            --background-main: linear-gradient(135deg, var(--gradient-start), var(--gradient-mid), var(--gradient-end));
            --container-bg: rgba(255, 255, 255, 0.2);
            --container-border: rgba(255, 255, 255, 0.3);
            --settings-bg: rgba(0, 0, 0, 0.08);
            --cell-bg: rgba(255, 255, 255, 0.9);
            --cell-hover-bg: rgba(255, 255, 255, 1);
            --text-light: #f0f0f0;
            --text-dark: #333;
            --text-on-container: var(--text-light); /* Text inside the semi-transparent container */
            --text-footer: rgba(255, 255, 255, 0.85);
            --accent-color: #ffcc00; /* Gold/Yellow */
            --player1-emoji-color: #4caf50; /* Greenish */
            --player2-emoji-color: #f44336; /* Reddish */
            --win-color: #00e676; /* Bright Green */
            --button-bg: #4a4e69;
            --button-hover-bg: #6b708f;
            --reset-button-bg: var(--player2-emoji-color);
            --reset-button-hover-bg: #d32f2f;
            --ad-placeholder-bg: rgba(0, 0, 0, 0.25);
            --ad-placeholder-border: rgba(255, 255, 255, 0.6);
            --ad-placeholder-text: rgba(255, 255, 255, 0.75);
            --modal-backdrop: rgba(0, 0, 0, 0.7);
            --modal-content-bg: #f8f9fa;
            --modal-content-text: var(--text-dark);
            --modal-title-color: var(--gradient-start);
            --modal-link-color: var(--gradient-mid);
            --border-radius: 15px;
            --shadow-light: 0 5px 15px rgba(0, 0, 0, 0.1);
            --shadow-strong: 0 10px 30px rgba(0, 0, 0, 0.2);
            --font-main: 'Poppins', sans-serif;
            --font-title: 'Orbitron', sans-serif;
            --cell-size-small: 80px;
            --cell-size-medium: 70px;
            --cell-size-large: 60px;
            --gap-size: 8px;
            --transition-speed: 0.3s;
        }

        /* Dark Theme Colors */
        .dark-theme {
            --gradient-start: #232526;
            --gradient-mid: #414345;
            --gradient-end: #232526;
            --container-bg: rgba(0, 0, 0, 0.3);
            --container-border: rgba(255, 255, 255, 0.15);
            --settings-bg: rgba(255, 255, 255, 0.08);
            --cell-bg: rgba(50, 50, 50, 0.85);
            --cell-hover-bg: rgba(70, 70, 70, 1);
            --text-light: #e0e0e0;
            --text-dark: #f0f0f0; /* Dark theme uses light text on dark inputs */
            --text-on-container: var(--text-light);
            --text-footer: rgba(255, 255, 255, 0.7);
            --accent-color: #f1c40f; /* Slightly different gold for dark */
            --player1-emoji-color: #2ecc71; /* Adjusted green */
            --player2-emoji-color: #e74c3c; /* Adjusted red */
            --win-color: #00cf70; /* Adjusted win green */
            --button-bg: #525575;
            --button-hover-bg: #73779a;
            --reset-button-bg: #e74c3c;
            --reset-button-hover-bg: #c0392b;
            --ad-placeholder-bg: rgba(255, 255, 255, 0.1);
            --ad-placeholder-border: rgba(255, 255, 255, 0.4);
            --ad-placeholder-text: rgba(255, 255, 255, 0.6);
            --modal-backdrop: rgba(0, 0, 0, 0.8);
            --modal-content-bg: #343a40; /* Dark modal background */
            --modal-content-text: var(--text-light);
            --modal-title-color: var(--accent-color);
            --modal-link-color: #8ab4f8; /* Light blue link for dark mode */
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        body {
            font-family: var(--font-main);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            min-height: 100vh;
            background: var(--background-main);
            background-size: 400% 400%;
            animation: gradientBG 20s ease infinite;
            color: var(--text-on-container); /* Default text color */
            padding: 15px;
            overflow-x: hidden;
            transition: background var(--transition-speed) ease-in-out;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- Header Controls (Theme Toggle, Share) --- */
        .header-controls {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 15px;
            z-index: 10; /* Ensure they are above game wrapper */
        }
        .control-button {
             background: rgba(255, 255, 255, 0.15);
             backdrop-filter: blur(5px);
             border: 1px solid rgba(255, 255, 255, 0.2);
             color: var(--text-light);
             font-size: 1.5em;
             cursor: pointer;
             padding: 8px;
             border-radius: 50%;
             width: 40px;
             height: 40px;
             display: flex;
             justify-content: center;
             align-items: center;
             transition: all var(--transition-speed) ease;
             box-shadow: var(--shadow-light);
        }
        .control-button:hover {
             background: rgba(255, 255, 255, 0.25);
             transform: scale(1.1);
             color: var(--accent-color);
        }
        /* Style adjustments for dark theme controls */
        .dark-theme .control-button {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
         .dark-theme .control-button:hover {
             background: rgba(0, 0, 0, 0.3);
         }


        /* --- Main Game Container --- */
        .game-wrapper {
            background: var(--container-bg);
            backdrop-filter: blur(12px);
            padding: 30px; /* Increased padding */
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-strong);
            text-align: center;
            max-width: 95%;
            width: 680px; /* Adjusted width */
            margin-top: 70px; /* Space down from top controls */
            margin-bottom: 20px;
            border: 1px solid var(--container-border);
            transition: background var(--transition-speed) ease-in-out, border var(--transition-speed) ease-in-out;
        }

        h1 {
            font-family: var(--font-title);
            color: var(--accent-color);
            margin-bottom: 30px; /* More space */
            font-size: 3em; /* Slightly larger */
            text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.4);
        }

        /* --- Settings Area --- */
        .settings-area {
            margin-bottom: 30px; /* More space */
            background: var(--settings-bg);
            padding: 20px;
            border-radius: 10px;
             transition: background var(--transition-speed) ease-in-out;
        }
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); /* Adjust minmax */
            gap: 20px; /* Increased gap */
            align-items: center;
        }
        .settings-group {
             display: flex;
             flex-direction: column;
             align-items: flex-start;
             gap: 8px; /* Increased gap */
        }
        .settings-group label {
            font-weight: 600;
            color: var(--text-on-container);
            font-size: 1em; /* Slightly larger label */
            padding-left: 5px;
        }
        .settings-controls {
             display: flex;
             gap: 10px;
             width: 100%;
        }
        .settings-controls button, .settings-controls select {
            flex-grow: 1;
            padding: 10px 15px; /* Increased padding */
            font-size: 0.95em; /* Slightly larger font */
            font-weight: 600;
            color: var(--text-dark);
            background-color: var(--cell-bg); /* Use cell bg for consistency */
            border: 1px solid rgba(0,0,0,0.1); /* Subtle border */
            border-radius: 8px;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            box-shadow: var(--shadow-light);
            text-align: center;
        }
        .dark-theme .settings-controls button, .dark-theme .settings-controls select {
             color: var(--text-light); /* Light text on dark inputs */
             border: 1px solid rgba(255,255,255,0.1);
        }
        .settings-controls select {
             appearance: none;
             background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23333' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
             background-repeat: no-repeat;
             background-position: right 10px center;
             background-size: 1em;
             padding-right: 30px;
             text-align-last: center;
        }
        .dark-theme .settings-controls select { /* Update arrow color for dark theme */
              background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23eee' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
        }
        .settings-controls button:hover, .settings-controls select:hover {
            background-color: var(--cell-hover-bg);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            border-color: rgba(0,0,0,0.2);
        }
        .dark-theme .settings-controls button:hover, .dark-theme .settings-controls select:hover {
            border-color: rgba(255,255,255,0.2);
        }
        .settings-controls button.active {
            background-color: var(--accent-color);
            color: var(--text-dark); /* Text color on active button */
            box-shadow: 0 0 15px color-mix(in srgb, var(--accent-color) 60%, transparent);
            border-color: color-mix(in srgb, var(--accent-color) 80%, black);
        }
         .dark-theme .settings-controls button.active {
            color: #333; /* Ensure dark text on accent button */
         }
        .settings-controls .emoji-select { font-size: 1.6em; padding: 5px 15px; }

        /* --- Scoreboard --- */
         .scoreboard {
            display: flex;
            justify-content: center;
            gap: 20px; /* Increased gap */
            margin-bottom: 30px; /* More space */
            flex-wrap: wrap;
        }
        .score {
            background: var(--settings-bg); /* Consistent background */
            padding: 12px 20px; /* Increased padding */
            border-radius: 10px; /* More rounded */
            transition: all var(--transition-speed) ease;
            font-size: 1.15em;
            font-weight: 600;
            text-align: center;
            color: var(--text-on-container);
            min-width: 160px; /* Ensure minimum width */
        }
        .score.active-turn {
            background-color: var(--accent-color);
            color: #333; /* Dark text on accent */
            transform: scale(1.05);
             box-shadow: 0 0 15px color-mix(in srgb, var(--accent-color) 60%, transparent);
        }
        .score span { font-weight: 700; }
        .score .emoji { font-size: 1.3em; margin-right: 8px; display: inline-block;}
        .score .streak { font-size: 0.85em; color: color-mix(in srgb, var(--text-on-container) 70%, transparent); display: block; margin-top: 4px;}


        /* --- Game Board --- */
        .game-board {
            display: grid;
            justify-content: center;
            margin: 25px auto; /* Adjusted margin */
            position: relative;
            transition: all 0.4s ease-in-out;
            max-width: 100%;
        }
        .board-3x3 { grid-template-columns: repeat(3, var(--cell-size-small)); grid-template-rows: repeat(3, var(--cell-size-small)); gap: var(--gap-size); }
        .board-4x4 { grid-template-columns: repeat(4, var(--cell-size-medium)); grid-template-rows: repeat(4, var(--cell-size-medium)); gap: var(--gap-size); }
        .board-5x5 { grid-template-columns: repeat(5, var(--cell-size-large)); grid-template-rows: repeat(5, var(--cell-size-large)); gap: var(--gap-size); }

        .cell {
            background-color: var(--cell-bg);
            border: none;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5em;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
            box-shadow: inset 0 3px 6px rgba(0,0,0,0.1), 0 6px 12px rgba(0,0,0,0.15);
            transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
            transform-style: preserve-3d;
        }
        .board-4x4 .cell { font-size: 2.2em; }
        .board-5x5 .cell { font-size: 1.9em; }

        .cell:hover {
            background-color: var(--cell-hover-bg);
            transform: scale(1.07) translateZ(7px); /* Enhanced lift */
            box-shadow: inset 0 3px 6px rgba(0,0,0,0.1), 0 12px 24px rgba(0,0,0,0.25);
        }
        .cell:active { transform: scale(0.96) translateZ(4px); }

        .cell span {
            display: inline-block;
            transition: transform 0.35s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            text-shadow: 1px 1px 4px rgba(0,0,0,0.25);
        }
        .cell.p1 span { color: var(--player1-emoji-color); transform: scale(1); }
        .cell.p2 span { color: var(--player2-emoji-color); transform: scale(1); }
         .cell:not(:empty) span { animation: popIn 0.35s cubic-bezier(0.68, -0.55, 0.27, 1.55); }

        @keyframes popIn { /* Same as before */ }

        .cell.win {
            background-color: var(--win-color);
            animation: winPulse 0.8s infinite alternate ease-in-out;
        }
        .cell.win span {
            color: white;
            animation: winEmojiPulse 0.8s infinite alternate ease-in-out;
        }

        @keyframes winPulse { /* Same as before */ }
        @keyframes winEmojiPulse { /* Same as before */ }

        /* Winning Line Styles */
        #winLine {
            position: absolute;
            background: linear-gradient(90deg, rgba(255, 204, 0, 0.7), rgba(255, 230, 100, 0.9), rgba(255, 204, 0, 0.7));
            height: 8px;
            border-radius: 4px;
            transform-origin: left center;
            box-shadow: 0 0 15px var(--accent-color);
            display: none;
            z-index: 5;
            transition: width 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55); /* Spring animation */
        }

        /* --- Status Display --- */
        #status {
            font-size: 1.5em; /* Slightly larger */
            margin: 25px 0; /* More margin */
            min-height: 35px; /* Reserve more space */
            font-weight: 600;
            transition: color var(--transition-speed) ease, transform var(--transition-speed) ease;
            color: var(--text-on-container);
        }
        #status.win-message { color: var(--win-color); font-weight: 700; transform: scale(1.05); }
        #status.draw-message { color: var(--accent-color); transform: scale(1.05); }
        #status.ai-thinking { color: var(--accent-color); font-style: italic; }


        /* --- Action Buttons --- */
        .action-buttons {
            margin-top: 30px; /* More space */
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px; /* Increased gap */
        }
        .action-buttons button {
            padding: 14px 32px; /* More padding */
            font-size: 1.1em;
            font-weight: 600;
            color: var(--text-light);
            background-color: var(--button-bg);
            border: none;
            border-radius: 10px; /* More rounded */
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            box-shadow: var(--shadow-light);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .action-buttons button:hover {
            background-color: var(--button-hover-bg);
            transform: translateY(-4px); /* More lift */
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        .action-buttons button#resetScoreButton { background-color: var(--reset-button-bg); }
        .action-buttons button#resetScoreButton:hover { background-color: var(--reset-button-hover-bg); }


        /* --- Confetti Canvas --- */
        #confettiCanvas { /* Same as before */ }

        /* --- Modals --- */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: var(--modal-backdrop);
            backdrop-filter: blur(8px); /* Stronger blur */
            align-items: center;
            justify-content: center;
        }
        .modal.active {
             display: flex;
             animation: fadeIn 0.4s ease-out;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
        .modal.fade-out { animation: fadeOut 0.4s ease-out forwards; }

        .modal-content {
            background-color: var(--modal-content-bg);
            color: var(--modal-content-text);
            margin: auto;
            padding: 40px; /* More padding */
            border: none;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 700px; /* Wider modal */
            box-shadow: var(--shadow-strong);
            position: relative;
            animation: slideInModal 0.4s ease-out;
             transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease;
        }
         @keyframes slideInModal { /* Same as before */ }

        .modal-close {
            color: #aaa;
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            z-index: 101; /* Ensure close button is above content */
        }
         .dark-theme .modal-close { color: #ccc;}
        .modal-close:hover,
        .modal-close:focus {
            color: #555;
            transform: rotate(90deg) scale(1.1);
            text-decoration: none;
        }
         .dark-theme .modal-close:hover, .dark-theme .modal-close:focus { color: #fff;}

        .modal-content h2 {
            margin-top: 0;
            margin-bottom: 30px; /* More space */
            color: var(--modal-title-color);
            font-family: var(--font-title);
            text-align: center;
            font-size: 2em; /* Larger title */
        }
        .modal-content p, .modal-content ul, .modal-content form {
            margin-bottom: 20px;
            line-height: 1.75; /* Improved readability */
            text-align: left;
            font-size: 1em;
        }
         .modal-content ul { padding-left: 30px; }
         .modal-content a { color: var(--modal-link-color); text-decoration: none; font-weight: 600;}
         .modal-content a:hover { text-decoration: underline;}

         /* Contact Form Styles */
         #contactForm label { display: block; margin-bottom: 6px; font-weight: 600;}
         #contactForm input[type="text"],
         #contactForm input[type="email"],
         #contactForm textarea {
            width: 100%;
            padding: 12px; /* More padding */
            margin-bottom: 18px;
            border: 1px solid #ccc;
            border-radius: 8px; /* More rounded */
            font-family: var(--font-main);
            font-size: 1em;
            background-color: var(--cell-bg); /* Use consistent bg */
            color: var(--modal-content-text); /* Match text color */
             transition: border-color var(--transition-speed), background-color var(--transition-speed);
         }
         .dark-theme #contactForm input[type="text"],
         .dark-theme #contactForm input[type="email"],
         .dark-theme #contactForm textarea {
             border: 1px solid #555;
         }
          #contactForm textarea { resize: vertical; min-height: 90px; }
          #contactForm button {
             padding: 12px 24px;
             background-color: var(--modal-link-color);
             color: var(--modal-content-bg); /* Contrast text */
             border: none;
             border-radius: 8px;
             cursor: pointer;
             font-weight: bold;
             transition: background-color var(--transition-speed);
             font-size: 1em;
          }
          #contactForm button:hover { background-color: color-mix(in srgb, var(--modal-link-color) 80%, black); }
           .dark-theme #contactForm button {
             background-color: var(--modal-link-color);
             color: #333; /* Dark text on light blue button */
           }
            .dark-theme #contactForm button:hover {
                background-color: color-mix(in srgb, var(--modal-link-color) 80%, white);
            }
          #contactInfoMessage {
             margin-top: 20px;
             padding: 15px;
             background-color: color-mix(in srgb, var(--modal-link-color) 15%, transparent);
             border-left: 5px solid var(--modal-link-color);
             font-weight: 500;
             display: none;
             border-radius: 5px;
          }


         /* Winner Popup Specific Styles */
        #winnerPopup .modal-content { /* Same as before */ }
         #winnerPopup h2 { /* Same as before */ }
         #winnerPopup p { /* Same as before */ }
         #winnerPopup button { /* Same as before */ }


        /* --- Footer --- */
        footer {
            width: 100%;
            text-align: center;
            padding: 25px 0 15px 0;
            margin-top: auto;
            font-size: 0.9em;
            color: var(--text-footer);
             transition: color var(--transition-speed);
        }
        footer a {
            color: var(--accent-color);
            text-decoration: none;
            margin: 0 10px;
            transition: color var(--transition-speed) ease;
        }
        footer a:hover {
            color: var(--text-light);
            text-decoration: underline;
        }
         .dark-theme footer a:hover {
            color: var(--accent-color);
         }
        footer .footer-separator {
            margin: 10px auto; /* Increased margin */
            width: 60px;
            height: 1px;
            background-color: rgba(255, 255, 255, 0.3);
            transition: background-color var(--transition-speed);
        }
         .dark-theme footer .footer-separator { background-color: rgba(255, 255, 255, 0.2);}


        /* --- Ad Placeholders --- */
        .ad-placeholder {
            background-color: var(--ad-placeholder-bg);
            border: 1px dashed var(--ad-placeholder-border);
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 30px auto; /* Increased margin */
            padding: 10px;
            max-width: 90%;
            width: 468px;
            color: var(--ad-placeholder-text);
            font-size: 1em;
            border-radius: 10px; /* More rounded */
            text-align: center;
             transition: background-color var(--transition-speed), border-color var(--transition-speed), color var(--transition-speed);
        }
         .ad-placeholder.top { margin-bottom: 35px; }
         .ad-placeholder.bottom { margin-top: 35px; }


        /* --- Utility Classes --- */
        .hidden { display: none !important; }
         /* Feedback message for copy to clipboard */
         #copyFeedback {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--accent-color);
            color: #333;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            z-index: 1100;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            pointer-events: none; /* Don't block clicks */
        }
         #copyFeedback.show { opacity: 1; }


        /* --- Responsive Design --- */
        @media (max-width: 768px) {
             h1 { font-size: 2.4em; }
             .game-wrapper { padding: 20px; width: 95%; margin-top: 80px; } /* Adjust margin for header controls */
             .settings-grid { grid-template-columns: 1fr; gap: 15px;}
             .scoreboard { gap: 15px; }
             .score { font-size: 1.05em; padding: 10px 15px; min-width: 140px;}
             #status { font-size: 1.35em; }
             .action-buttons button { padding: 12px 25px; font-size: 1em; }

             :root {
                 --cell-size-small: 70px;
                 --cell-size-medium: 60px;
                 --cell-size-large: 50px;
                 --gap-size: 6px;
             }
             .cell { font-size: 2em; }
             .board-4x4 .cell { font-size: 1.8em; }
             .board-5x5 .cell { font-size: 1.6em; }

             .modal-content { width: 92%; padding: 30px; }
             .modal-content h2 { font-size: 1.7em;}
             footer { font-size: 0.85em; }
             .ad-placeholder { width: 90%; min-height: 60px; }
             .header-controls { gap: 10px; }
             .control-button { font-size: 1.3em; width: 35px; height: 35px; padding: 6px;}
        }

        @media (max-width: 480px) {
            h1 { font-size: 2em; margin-bottom: 25px;}
            .game-wrapper { padding: 15px; margin-top: 75px;}
            :root {
                 --cell-size-small: 60px;
                 --cell-size-medium: 55px; /* Adjusted */
                 --cell-size-large: 48px; /* Adjusted */
                 --gap-size: 5px;
            }
             .cell { font-size: 1.8em; }
             .board-4x4 .cell { font-size: 1.6em; }
             .board-5x5 .cell { font-size: 1.4em; }

            #status { font-size: 1.2em; margin: 20px 0; }
            .action-buttons { gap: 10px; }
            .action-buttons button { width: calc(50% - 5px); padding: 12px 15px; font-size: 0.95em;}
            .scoreboard { font-size: 1em; gap: 10px;}
            .score { padding: 8px 12px; min-width: 130px;}
            .ad-placeholder { min-height: 50px; }
             #winnerPopup h2 {font-size: 2.2em;}
             #winnerPopup p {font-size: 1.3em;}
             .settings-grid { gap: 12px;}
             .settings-controls button, .settings-controls select { padding: 9px 12px;}
             .modal-content { padding: 25px; }
             .modal-content h2 { font-size: 1.6em; }
        }

    </style>
</head>
<body class=""> <!-- Theme class will be added here by JS -->

    <div class="header-controls">
        <button id="themeToggle" class="control-button" title="Toggle Theme"><i class="fas fa-sun"></i></button>
        <button id="shareButton" class="control-button" title="Share Game"><i class="fas fa-share-alt"></i></button>
        <button id="soundToggle" class="control-button" title="Toggle Sound"><i class="fas fa-volume-up"></i></button>
    </div>

    <canvas id="confettiCanvas"></canvas>

    <div class="game-wrapper">
        <h1>Tic Tac Toe Universe</h1>

        <!-- Ad Placeholder 1 (Top - Below Settings) -->
        <div class="ad-placeholder top" id="adSlot1">Advertisement Area 1 (e.g., 468x60 Banner) <!-- Your AdSense Code Here --></div>

        <div class="settings-area">
            <div class="settings-grid">
                <div class="settings-group">
                    <label for="boardSizeSelect">Board Size:</label>
                    <div class="settings-controls"> <select id="boardSizeSelect"> <option value="3">3x3</option> <option value="4">4x4</option> <option value="5">5x5</option> </select> </div>
                </div>
                <div class="settings-group">
                     <label>Game Mode:</label>
                     <div class="settings-controls"> <button id="pvpButton" class="mode-button active">🧑 vs 🧑</button> <button id="pveButton" class="mode-button">🧑 vs 🤖</button> </div>
                </div>
                <div class="settings-group hidden" id="difficultyGroup">
                     <label for="difficultySelect">AI Level:</label>
                     <div class="settings-controls"> <select id="difficultySelect"> <option value="easy">Easy</option> <option value="medium" selected>Medium</option> <option value="hard">Hard</option> </select> </div>
                </div>
                 <div class="settings-group">
                     <label>Player Emojis:</label>
                     <div class="settings-controls">
                        <select id="player1EmojiSelect" class="emoji-select"> <option value="👽">👽</option> <option value="⭐">⭐</option> <option value="🚀">🚀</option> <option value="💎">💎</option> <option value="🍕">🍕</option> <option value="🦊">🦊</option> <option value="🐼">🐼</option> </select>
                        <select id="player2EmojiSelect" class="emoji-select"> <option value="🤖">🤖</option> <option value="👻">👻</option> <option value="💖">💖</option> <option value="👑">👑</option> <option value="🍔">🍔</option> <option value="🐙">🐙</option> <option value="🦄">🦄</option> </select>
                     </div>
                 </div>
             </div>
        </div>

        <div class="scoreboard">
             <div class="score" id="player1ScoreIndicator">
                 <span class="emoji">P1</span> Score: <span id="scoreP1">0</span>
                 <span class="streak">(Streak: <span id="streakP1">0</span>)</span>
             </div>
             <div class="score" id="player2ScoreIndicator">
                 <span class="emoji">P2</span> Score: <span id="scoreP2">0</span>
                  <span class="streak">(Streak: <span id="streakP2">0</span>)</span>
             </div>
         </div>

        <div id="gameBoard" class="game-board">
            <!-- Cells generated by JS -->
             <div id="winLine"></div>
        </div>

        <div id="status">Choose settings and start playing!</div>

         <!-- Ad Placeholder 2 (Bottom - Below Board/Status) -->
        <div class="ad-placeholder bottom" id="adSlot2">Advertisement Area 2 (e.g., 300x250) <!-- Your AdSense Code Here --></div>

        <div class="action-buttons">
             <button id="restartButton">Restart Game</button>
             <button id="resetScoreButton">Reset Score</button>
        </div>
    </div>

    <footer>
        <a href="#" id="aboutLink">About Us</a> |
        <a href="#" id="termsLink">Terms & Conditions</a> |
        <a href="#" id="privacyLink">Privacy Policy</a> |
        <a href="#" id="disclaimerLink">Disclaimer</a> |
        <a href="#" id="contactLink">Contact Us</a>
        <div class="footer-separator"></div>
        © <span id="footerYear">2025</span> Tic Tac Toe Universe. All rights reserved.
    </footer>

    <!-- Modals -->
    <div id="aboutModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" data-modal-id="aboutModal">×</span>
            <h2>About Us</h2>
            <p>Welcome to Tic Tac Toe Universe! We are passionate about creating fun, engaging, and visually appealing web games for everyone to enjoy.</p>
            <p>Our goal is to provide a premium Tic Tac Toe experience with enhanced features like multiple board sizes, challenging AI opponents with different difficulty levels, custom player emojis, sound effects, win streaks, day/night mode, and a clean, responsive design.</p>
            <p>This game was developed with modern web technologies (HTML, CSS, JavaScript) and includes libraries like Font Awesome for icons and Canvas Confetti for celebrations. We strive to continuously improve the game based on user feedback.</p>
            <p>We hope you have a fantastic time playing! For any inquiries, suggestions, or feedback, please use the Contact Us section.</p>
        </div>
    </div>

    <div id="termsModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" data-modal-id="termsModal">×</span>
            <h2>Terms and Conditions</h2>
            <p><strong>Last updated: <span class="currentDate">[Date Placeholder]</span></strong></p>
            <p>Please read these terms and conditions carefully before using Our Service.</p>
             <p><strong>Acknowledgement</strong><br>These are the Terms and Conditions governing the use of this Service (Tic Tac Toe Universe game website). By accessing or using the Service, You agree to be bound by these Terms and Conditions. If You disagree with any part, You may not access the Service. Your access to and use of the Service is also conditioned on Your acceptance of and compliance with the Privacy Policy of the Company.</p>
            <p><strong>Using the Service</strong><br>Our Service provides a Tic Tac Toe game for personal entertainment purposes. You agree not to use the Service for any illegal or unauthorized purpose. You agree not to interfere with or disrupt the Service, servers, or networks connected to the Service.</p>
             <p><strong>Intellectual Property</strong><br>The Service and its original content (excluding user-selected emojis or content from third-party libraries like Font Awesome or Canvas Confetti), features, and functionality are and will remain the exclusive property of Tic Tac Toe Universe and its licensors. The Service is protected by copyright and other intellectual property laws.</p>
             <p><strong>Advertisements</strong><br>This Service displays advertisements, primarily through Google AdSense, which are necessary to support the free availability of the game. We are not responsible for the content, promises, or practices of any third-party advertisers. Your interactions with advertisers are solely between You and the advertiser.</p>
             <p><strong>Limitation of Liability</strong><br>To the maximum extent permitted by applicable law, in no event shall Tic Tac Toe Universe or its suppliers be liable for any special, incidental, indirect, or consequential damages whatsoever (including, but not limited to, damages for loss of profits, loss of data or other information, for business interruption, for personal injury, loss of privacy) arising out of or in any way related to the use of or inability to use the Service.</p>
             <p><strong>"AS IS" and "AS AVAILABLE" Disclaimer</strong><br>The Service is provided to You "AS IS" and "AS AVAILABLE" and with all faults and defects without warranty of any kind. [...] We provide no warranty that the Service will meet Your requirements, achieve any intended results, be compatible or work with any other software, systems or services, operate without interruption, meet any performance or reliability standards or be error free or that any errors or defects can or will be corrected.</p>
            <p><strong>Governing Law</strong><br>The laws of [Your Country/State, e.g., India or California - **Please Update**], excluding its conflicts of law rules, shall govern these Terms and Your use of the Service.</p>
             <p><strong>Changes to These Terms and Conditions</strong><br>We reserve the right, at Our sole discretion, to modify or replace these Terms at any time. If a revision is material We will make reasonable efforts to provide at least 30 days' notice prior to any new terms taking effect. [...] By continuing to access or use Our Service after those revisions become effective, You agree to be bound by the revised terms.</p>
            <p><strong>Contact Us</strong><br>If you have any questions about these Terms and Conditions, You can contact us: By email: mindsetmentor320@gmail.com</p>
            <p><em>(Note: This is a template. Consult a legal professional for terms suitable for your specific situation and jurisdiction.)</em></p>
        </div>
    </div>

    <div id="privacyModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" data-modal-id="privacyModal">×</span>
            <h2>Privacy Policy</h2>
            <p><strong>Last updated: <span class="currentDate">[Date Placeholder]</span></strong></p>
            <p>This Privacy Policy describes Our policies and procedures on the collection, use and disclosure of Your information when You use the Tic Tac Toe Universe game Service.</p>
            <p><strong>Information Collection and Use</strong><br>We do not directly collect Personally Identifiable Information (PII) from users playing the game. Game state information (like scores, settings, theme preference) is stored locally in your browser using technologies like `localStorage` during your session and is not transmitted to our servers.</p>
            <p><strong>Third-Party Services & Data</strong></p>
            <ul>
                 <li><strong>Google AdSense:</strong> We use Google AdSense to serve advertisements. Google uses cookies to serve ads based on a user's prior visits to this website or other websites. Google's use of advertising cookies enables it and its partners to serve ads based on your visit to this site and/or other sites on the Internet. You may opt out of personalized advertising by visiting <a href="https://www.google.com/settings/ads" target="_blank" rel="noopener noreferrer">Google Ad Settings</a>. Alternatively, you can opt out of a third-party vendor's use of cookies for personalized advertising by visiting <a href="http://www.aboutads.info/choices/" target="_blank" rel="noopener noreferrer">www.aboutads.info/choices</a>. Google's Privacy Policy can be found <a href="https://policies.google.com/privacy" target="_blank" rel="noopener noreferrer">here</a>.</li>
                <li><strong>Web Fonts & Libraries:</strong> We use third-party libraries like Google Fonts, Font Awesome, and Canvas Confetti loaded via Content Delivery Networks (CDNs). These services might collect aggregated usage data or IP addresses as part of their service delivery, governed by their respective privacy policies.</li>
            </ul>
             <p><strong>Cookies & Local Storage</strong><br>We use `localStorage` to save your game settings preferences (like theme choice) for a better user experience. We do not set essential cookies for the game functionality itself. Our advertising partner (Google AdSense) uses cookies as described above. You can manage cookie preferences and clear local storage through your browser settings.</p>
            <p><strong>Data Security</strong><br>As we do not collect sensitive personal data directly, the main security aspect relates to the third-party services we use. We rely on the security measures implemented by Google AdSense and the CDN providers. Data stored in `localStorage` is stored on your device.</p>
             <p><strong>Children's Privacy</strong><br>Our Service is not directed at children under the age of 13 (or relevant age in your jurisdiction). We do not knowingly collect personal information from children. If You are a parent or guardian and You are aware that Your child has provided Us with Personal Data through third-party services like ads, please contact Us.</p>
             <p><strong>Changes to this Privacy Policy</strong><br>We may update Our Privacy Policy from time to time. We will notify You of any changes by posting the new Privacy Policy on this page and updating the "Last updated" date. You are advised to review this Privacy Policy periodically for any changes.</p>
            <p><strong>Contact Us</strong><br>If you have any questions about this Privacy Policy, You can contact us:<br>By email: mindsetmentor320@gmail.com</p>
            <p><em>(Note: Ensure this policy accurately reflects your data practices and complies with relevant regulations like GDPR/CCPA. Legal advice is recommended.)</em></p>
        </div>
    </div>

    <div id="disclaimerModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" data-modal-id="disclaimerModal">×</span>
            <h2>Disclaimer</h2>
            <p><strong>Last updated: <span class="currentDate">[Date Placeholder]</span></strong></p>
            <p>The information and game provided by Tic Tac Toe Universe (the "Service") are for general entertainment purposes only. All information and game mechanics on the Service are provided in good faith, however, we make no representation or warranty of any kind, express or implied, regarding the accuracy, adequacy, validity, reliability, availability, or completeness of any information or game functionality on the Service.</p>
            <p><strong>Game Disclaimer</strong><br>The Tic Tac Toe game is provided purely for entertainment. While we aim for a balanced and functional experience, we make no guarantees regarding the AI's performance, the outcome of any game, or the absence of bugs or errors. Gameplay results depend on player skill, strategy, and chance elements (like AI choices in easier modes).</p>
             <p><strong>External Links & Advertising Disclaimer</strong><br>The Service displays advertisements (e.g., via Google AdSense) and may contain links to external websites that are not provided or maintained by or in any way affiliated with us. We do not guarantee the accuracy, relevance, timeliness, or completeness of any information on these external websites or the claims made in advertisements. We are not responsible for the content or practices of third-party sites or advertisers.</p>
             <p><strong>No Professional Advice</strong><br>The content on this Service is not intended to be a substitute for professional advice. Any reliance you place on such information is strictly at your own risk.</p>
            <p><strong>Limitation of Liability</strong><br>UNDER NO CIRCUMSTANCE SHALL WE HAVE ANY LIABILITY TO YOU FOR ANY LOSS OR DAMAGE OF ANY KIND INCURRED AS A RESULT OF THE USE OF THE SERVICE OR RELIANCE ON ANY INFORMATION PROVIDED ON THE SERVICE. YOUR USE OF THE SERVICE AND YOUR RELIANCE ON ANY INFORMATION ON THE SERVICE IS SOLELY AT YOUR OWN RISK.</p>
        </div>
    </div>

     <div id="contactModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" data-modal-id="contactModal">×</span>
            <h2>Contact Us</h2>
            <p>Have questions, feedback, or suggestions? We'd love to hear from you!</p>
             <form id="contactForm">
                 <label for="contactName">Name:</label>
                 <input type="text" id="contactName" name="name" placeholder="Your Name (Optional)">
                 <label for="contactEmail">Email:</label>
                 <input type="email" id="contactEmail" name="email" placeholder="Your Email (Optional, for response)">
                 <label for="contactMessage">Message:</label>
                 <textarea id="contactMessage" name="message" rows="4" required placeholder="Your message..."></textarea>
                 <button type="submit" id="submitContact">Show Contact Email</button>
             </form>
             <div id="contactInfoMessage">
                 Thank you! To send your message, please use your email client to contact: <a href="mailto:mindsetmentor320@gmail.com"><strong>mindsetmentor320@gmail.com</strong></a>
            </div>
        </div>
    </div>

    <div id="winnerPopup" class="modal">
        <div class="modal-content">
            <h2 id="winnerPopupTitle">🎉 Victory! 🎉</h2>
            <p id="winnerPopupMessage">Player X Wins!</p>
            <button id="winnerPopupClose">Play Again</button>
        </div>
    </div>

    <!-- Feedback message for copy URL -->
    <div id="copyFeedback">Link Copied!</div>


    <script>
        // JavaScript Logic - Final Enhanced Version
        const gameBoard = document.getElementById('gameBoard');
        const statusDisplay = document.getElementById('status');
        const restartButton = document.getElementById('restartButton');
        const resetScoreButton = document.getElementById('resetScoreButton');
        const scoreP1Element = document.getElementById('scoreP1');
        const scoreP2Element = document.getElementById('scoreP2');
        const streakP1Element = document.getElementById('streakP1');
        const streakP2Element = document.getElementById('streakP2');
        const player1ScoreIndicator = document.getElementById('player1ScoreIndicator');
        const player2ScoreIndicator = document.getElementById('player2ScoreIndicator');
        const boardSizeSelect = document.getElementById('boardSizeSelect');
        const pvpButton = document.getElementById('pvpButton');
        const pveButton = document.getElementById('pveButton');
        const difficultyGroup = document.getElementById('difficultyGroup');
        const difficultySelect = document.getElementById('difficultySelect');
        const player1EmojiSelect = document.getElementById('player1EmojiSelect');
        const player2EmojiSelect = document.getElementById('player2EmojiSelect');
        const winLineElement = document.getElementById('winLine');
        const confettiCanvas = document.getElementById('confettiCanvas');
        const soundToggleButton = document.getElementById('soundToggle');
        const themeToggleButton = document.getElementById('themeToggle');
        const shareButton = document.getElementById('shareButton');
        const copyFeedbackElement = document.getElementById('copyFeedback');

        // Modal related elements
        const modalLinks = { /* as before */ };
        const modals = { /* as before */ };
        const closeButtons = document.querySelectorAll('.modal-close');
        const winnerPopupCloseButton = document.getElementById('winnerPopupClose');
        const winnerPopupTitle = document.getElementById('winnerPopupTitle');
        const winnerPopupMessage = document.getElementById('winnerPopupMessage');
        const contactForm = document.getElementById('contactForm');
        const contactInfoMessage = document.getElementById('contactInfoMessage');

        // --- Game State Variables ---
        let cells = [];
        let currentPlayer;
        let gameActive = false;
        let gameState = [];
        let scores = { p1: 0, p2: 0 };
        let streaks = { p1: 0, p2: 0 };
        let boardSize = 3;
        let winLength = 3;
        let gameMode = 'pvp';
        let aiDifficulty = 'medium';
        let humanPlayer = 'p1';
        let aiPlayer = 'p2';
        let player1Emoji = '👽';
        let player2Emoji = '🤖';
        let currentPlayerStarts = 'p1';
        let isMuted = localStorage.getItem('tttUniverseMuted') === 'true'; // Load mute state
        let currentTheme = localStorage.getItem('tttUniverseTheme') || 'light'; // Load theme state

        // --- Sound Effects ---
        let moveSound, winSound;
        function loadSounds() {
            try {
                // ** IMPORTANT: Place 'move.mp3' and 'win.mp3' in the same folder as this HTML file, **
                // ** or update the paths below to the correct location of your sound files.      **
                moveSound = new Audio('move.mp3');
                winSound = new Audio('win.mp3');
                console.log("Sound files loaded successfully (or placeholder created).");
            } catch (e) {
                console.warn("Could not initialize audio. Ensure sound files exist and paths are correct.", e);
                // Create dummy objects so game doesn't crash if Audio fails
                moveSound = { play: () => {}, currentTime: 0 };
                winSound = { play: () => {}, currentTime: 0 };
                 // Visually disable sound toggle if loading fails completely
                 soundToggleButton.style.opacity = '0.5';
                 soundToggleButton.style.pointerEvents = 'none';
                 soundToggleButton.title = "Sound disabled (files not found)";
                 isMuted = true; // Force mute if sounds can't load
            } finally {
                 // Update button state based on loaded preference or forced mute
                 updateSoundButtonIcon();
            }
        }

        // --- Confetti ---
        const myConfetti = confetti.create(confettiCanvas, { resize: true, useWorker: true });
        function fireConfetti() { /* as before */ }

        // --- Initialization ---
        function initializeGame() {
            boardSize = parseInt(boardSizeSelect.value);
            winLength = boardSize;
            player1Emoji = player1EmojiSelect.value;
            player2Emoji = player2EmojiSelect.value;
            player1ScoreIndicator.querySelector('.emoji').textContent = player1Emoji;
            player2ScoreIndicator.querySelector('.emoji').textContent = gameMode === 'pvp' ? player2Emoji : '🤖';

            gameState = Array(boardSize * boardSize).fill("");
            cells = [];
            gameBoard.innerHTML = '';
            winLineElement.style.display = 'none';
            winLineElement.style.width = '0px';

            gameBoard.className = 'game-board';
            gameBoard.classList.add(`board-${boardSize}x${boardSize}`);
            gameBoard.style.gridTemplateColumns = `repeat(${boardSize}, var(--cell-size-${boardSize === 3 ? 'small' : boardSize === 4 ? 'medium' : 'large'}))`;
            gameBoard.style.gridTemplateRows = `repeat(${boardSize}, var(--cell-size-${boardSize === 3 ? 'small' : boardSize === 4 ? 'medium' : 'large'}))`;
            gameBoard.style.gap = `var(--gap-size)`;

            for (let i = 0; i < boardSize * boardSize; i++) { /* Create cells as before */ }

            currentPlayer = currentPlayerStarts;
            gameActive = true;
            statusDisplay.textContent = `Player ${currentPlayer === 'p1' ? player1Emoji : (gameMode === 'pvp' ? player2Emoji : '🤖')}'s turn`;
            statusDisplay.className = '';
            updateTurnIndicator();
            enableBoardInteraction();

            if (gameMode === 'pve' && currentPlayer === aiPlayer) { /* AI start logic as before */ }
        }

        function updateSettings() {
            currentPlayerStarts = 'p1';
            scores = { p1: 0, p2: 0 };
            streaks = { p1: 0, p2: 0 };
            updateScoreDisplay();
            initializeGame();
        }

        function updateTurnIndicator() { /* as before */ }
        function updateScoreDisplay() { /* as before */ }

        // --- Event Listeners Setup ---
        boardSizeSelect.addEventListener('change', updateSettings);
        player1EmojiSelect.addEventListener('change', updateSettings);
        player2EmojiSelect.addEventListener('change', updateSettings);
        difficultySelect.addEventListener('change', () => { aiDifficulty = difficultySelect.value; updateSettings(); });
        pvpButton.addEventListener('click', () => { /* as before */ });
        pveButton.addEventListener('click', () => { /* as before */ });
        restartButton.addEventListener('click', initializeGame);
        resetScoreButton.addEventListener('click', () => { /* Includes streak reset */ });

        // Sound Toggle Listener
        soundToggleButton.addEventListener('click', () => {
            isMuted = !isMuted;
            localStorage.setItem('tttUniverseMuted', isMuted); // Save preference
            updateSoundButtonIcon();
        });

         function updateSoundButtonIcon() {
            soundToggleButton.innerHTML = isMuted ? '<i class="fas fa-volume-mute"></i>' : '<i class="fas fa-volume-up"></i>';
            soundToggleButton.title = isMuted ? 'Unmute Sound' : 'Mute Sound';
         }


        // Theme Toggle Listener
        themeToggleButton.addEventListener('click', () => {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            applyTheme();
            localStorage.setItem('tttUniverseTheme', currentTheme); // Save preference
        });

        function applyTheme() {
            document.body.className = currentTheme === 'dark' ? 'dark-theme' : '';
            themeToggleButton.innerHTML = currentTheme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
            themeToggleButton.title = currentTheme === 'dark' ? 'Switch to Light Mode' : 'Switch to Dark Mode';
        }

        // Share Button Listener
        shareButton.addEventListener('click', async () => {
            const shareData = {
                title: 'Tic Tac Toe Universe',
                text: 'Check out this awesome Tic Tac Toe game!',
                url: window.location.href // Share the current page URL
            };
            try {
                if (navigator.share) {
                    await navigator.share(shareData);
                    console.log('Game shared successfully');
                } else {
                    // Fallback for desktop/unsupported browsers: Copy URL
                    await navigator.clipboard.writeText(shareData.url);
                    showCopyFeedback('Link Copied!');
                }
            } catch (err) {
                console.error('Error sharing:', err);
                 // Fallback if share fails or clipboard fails
                 showCopyFeedback('Could not share/copy.');
            }
        });

         function showCopyFeedback(message) {
             copyFeedbackElement.textContent = message;
             copyFeedbackElement.classList.add('show');
             setTimeout(() => {
                 copyFeedbackElement.classList.remove('show');
             }, 2000); // Hide after 2 seconds
         }


        // Modal Listeners (Corrected)
        Object.keys(modalLinks).forEach(key => { /* as before */ });
        closeButtons.forEach(button => { /* as before */ });
        winnerPopupCloseButton.addEventListener('click', () => { /* as before */ });
        window.addEventListener('click', (event) => { /* as before */ });
        contactForm.addEventListener('submit', (e) => { /* as before */ });

        // --- Modal Functions (Corrected Hide Logic) ---
        function showModal(modalKey) { /* as before */ }
        function hideModal(modalId) { /* Corrected fade-out logic as before */ }

        // --- Update Dates in Modals ---
        function updateDynamicDates() {
            const dateElements = document.querySelectorAll('.currentDate');
            const today = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            const formattedDate = today.toLocaleDateString('en-US', options); // Or adjust locale
            dateElements.forEach(el => {
                el.textContent = formattedDate;
            });
            // Update footer year too
            document.getElementById('footerYear').textContent = today.getFullYear();
        }

        // --- Game Logic ---
        function handleCellClick(event) { /* as before */ }
        function makeMove(index) { /* Added playSound call */ }
        function changePlayer() { /* as before */ }
        function disableBoardInteraction() { /* Added opacity change */ }
        function enableBoardInteraction() { /* Added opacity change */ }
        function playSound(sound) { /* Checks isMuted */ }

        // --- Win/Draw Check ---
        function checkResult() { /* as before */ }
        function handleWin(winInfo) { /* Includes streak update */ }
        function handleDraw() { /* Includes streak reset */ }
        function highlightWinningCells(line) { /* as before */ }
        function drawWinningLine(line) { /* Added smooth animation trigger */ }
        function generateWinningLines(size, length) { /* as before */ }

        // --- AI Logic (Minimax and Heuristics) ---
        // The AI logic from the previous version is generally sound and kept here.
        function makeAIMove() { /* as before, with fallbacks */ }
        function getAvailableMoves(boardState) { /* as before */ }
        function getMediumAIMove(boardState, availableMoves) { /* as before */ }
        function getHardHeuristicMove(boardState, availableMoves) { /* as before */ }
        function minimax(newBoard, player) { /* as before */ }
        function checkWinnerInternal(boardState, player) { /* as before */ }
        function getCorners(size) { /* as before */ }
        function getSides(size) { /* as before */ }
        function getOppositeCornersMap(size) { /* as before */ }

        // --- Initial Setup on Load ---
        document.addEventListener('DOMContentLoaded', () => {
             loadSounds(); // Load sounds first
             applyTheme(); // Apply saved or default theme
             updateDynamicDates(); // Set current dates in modals/footer
             initializeGame(); // Setup the initial game board
              // Make sure modal event listeners are properly attached after DOM is ready
             Object.keys(modalLinks).forEach(key => {
                 if (modalLinks[key]) {
                    modalLinks[key].addEventListener('click', (e) => { e.preventDefault(); showModal(key); });
                 }
             });
             closeButtons.forEach(button => {
                 button.addEventListener('click', () => {
                     const modalId = button.dataset.modalId; // Ensure this attribute exists on your buttons
                     if (modalId) hideModal(modalId);
                 });
             });
             winnerPopupCloseButton.addEventListener('click', () => { hideModal('winnerPopup'); initializeGame(); });
             window.addEventListener('click', (event) => { Object.values(modals).forEach(modalElement => { if (event.target == modalElement) hideModal(modalElement.id); }); });
             contactForm.addEventListener('submit', (e) => { e.preventDefault(); contactInfoMessage.style.display = 'block'; });
        });

    </script>

</body>
</html>
